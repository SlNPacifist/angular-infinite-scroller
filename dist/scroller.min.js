(function(){var a,b,c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};d={paddingTop:{min:100,max:150},paddingBottom:{min:100,max:150},itemsPerRequest:10,autoUpdateInterval:1e3,afterScrollWaitTime:100,topBoundaryTimeout:1e4,bottomBoundaryTimeout:1e4,bufferTopPadding:20,bufferBottomPadding:20},e=function(a,b){var c,d;return d=b.parentNode,b.nextSibling?(c=b.nextSibling,d.insertBefore(a,c)):d.appendChild(a)},a=function(){function a(){this.addItemsToStart=f(this.addItemsToStart,this),this.addItemsToEnd=f(this.addItemsToEnd,this),this.truncateTo=f(this.truncateTo,this),this.start=0,this.length=0}return a.prototype.truncateTo=function(a,b){var c,d,e,f,g,h,i,j;if(this.start<a){for(d=e=g=this.start,h=a;h>=g?h>e:e>h;d=h>=g?++e:--e)delete this[d];this.length=Math.max(0,this.length-(a-this.start)),this.start=a}if(c=this.start+this.length-1,c>b){for(d=f=i=c,j=b;j>=i?j>f:f>j;d=j>=i?++f:--f)delete this[d];return this.length=Math.max(0,this.length-(c-b))}},a.prototype.addItemsToEnd=function(a){var b,c,d,e;for(b=d=0,e=a.length;e>d;b=++d)c=a[b],this[this.start+this.length+b]=c;return this.length+=a.length},a.prototype.addItemsToStart=function(a){var b,c,d,e;for(this.start-=a.length,b=d=0,e=a.length;e>d;b=++d)c=a[b],this[this.start+b]=c;return this.length+=a.length},a}(),c=function(){function b(b,c){this.scope=b,this._element=c,this.preserveScroll=f(this.preserveScroll,this),this._tryDrawBottomItem=f(this._tryDrawBottomItem,this),this._tryDrawTopItem=f(this._tryDrawTopItem,this),this._removeBottomDrawnItem=f(this._removeBottomDrawnItem,this),this._removeTopDrawnItem=f(this._removeTopDrawnItem,this),this._truncateBuffer=f(this._truncateBuffer,this),this._addBottomDrawnItem=f(this._addBottomDrawnItem,this),this._addTopDrawnItem=f(this._addTopDrawnItem,this),this._updateState=f(this._updateState,this),this._updateStateAsync=f(this._updateStateAsync,this),this._requestMoreBottomItems=f(this._requestMoreBottomItems,this),this._canRequestMoreBottomItems=f(this._canRequestMoreBottomItems,this),this._requestMoreTopItems=f(this._requestMoreTopItems,this),this._canRequestMoreTopItems=f(this._canRequestMoreTopItems,this),this._changeAutoUpdateInterval=f(this._changeAutoUpdateInterval,this),this._updateSettings=f(this._updateSettings,this),this._updateSettings(),this.scope.$watch("scrollerSettings",this._updateSettings,!0),this._getItems=this.scope.scrollerSource.bind(this),this._drawnItems=[],this._buffer=new a,this._requesting_top_items=!1,this._requesting_bottom_items=!1,this._updateStateAsync(),this._element.addEventListener("scroll",this._updateStateAsync)}return b.prototype._updateSettings=function(){var a,b,c,e,f,g,h,i,j,k,l,m,n;return a={paddingTop:{min:null!=(b=this.scope.$eval("scrollerSettings.paddingTop.min"))?b:d.paddingTop.min,max:null!=(c=this.scope.$eval("scrollerSettings.paddingTop.max"))?c:d.paddingTop.max},paddingBottom:{min:null!=(g=this.scope.$eval("scrollerSettings.paddingBottom.min"))?g:d.paddingBottom.min,max:null!=(h=this.scope.$eval("scrollerSettings.paddingBottom.max"))?h:d.paddingBottom.max},itemsPerRequest:null!=(i=this.scope.$eval("scrollerSettings.itemsPerRequest"))?i:d.itemsPerRequest,autoUpdateInterval:null!=(j=this.scope.$eval("scrollerSettings.autoUpdateInterval"))?j:d.autoUpdateInterval,afterScrollWaitTime:null!=(k=this.scope.$eval("scrollerSettings.afterScrollWaitTime"))?k:d.afterScrollWaitTime,topBoundaryTimeout:null!=(l=this.scope.$eval("scrollerSettings.topBoundaryTimeout"))?l:d.topBoundaryTimeout,bottomBoundaryTimeout:null!=(m=this.scope.$eval("scrollerSettings.bottomBoundaryTimeout"))?m:d.bottomBoundaryTimeout,bufferTopPadding:null!=(n=this.scope.$eval("scrollerSettings.bufferTopPadding"))?n:d.bufferTopPadding,bufferBottomPadding:null!=(e=this.scope.$eval("scrollerSettings.bufferBottomPadding"))?e:d.bufferBottomPadding},(null!=(f=this._settings)?f.autoUpdateInterval:void 0)!==a.autoUpdateInterval&&this._changeAutoUpdateInterval(a.autoUpdateInterval),this._settings=a},b.prototype._changeAutoUpdateInterval=function(a){return null!=this._autoUpdateHandler&&window.clearInterval(this._autoUpdateHandler),this._autoUpdateHandler=window.setInterval(this._updateStateAsync,a)},b.prototype._canRequestMoreTopItems=function(){var a;return a=new Date,!(this._buffer.start===this._topBoundaryIndex&&a-this._topBoundaryIndexTimestamp<this._settings.topBoundaryTimeout)},b.prototype._requestMoreTopItems=function(){var a,b;if(!this._requesting_top_items)return this._requesting_top_items=!0,b=this._buffer.start-this._settings.itemsPerRequest,a=this._buffer.start,this._getItems(b,this._settings.itemsPerRequest,function(b){return function(c,d){return b._requesting_top_items=!1,c?void 0:0===d.length?(b._topBoundaryIndex=a,b._topBoundaryIndexTimestamp=new Date):(b._buffer.addItemsToStart(d),b._buffer.start<b._topBoundaryIndex&&(b._topBoundaryIndex=null),b._updateStateAsync())}}(this))},b.prototype._canRequestMoreBottomItems=function(){var a;return a=new Date,!(this._buffer.start+this._buffer.length===this._bottomBoundaryIndex&&a-this._bottomBoundaryIndexTimestamp<this._settings.bottomBoundaryTimeout)},b.prototype._requestMoreBottomItems=function(){var a;if(!this._requesting_bottom_items)return this._requesting_bottom_items=!0,a=this._buffer.start+this._buffer.length,this._getItems(a,this._settings.itemsPerRequest,function(b){return function(c,d){return b._requesting_bottom_items=!1,c?void 0:0===d.length?(b._bottomBoundaryIndex=a,b._bottomBoundaryIndexTimestamp=new Date):(b._buffer.addItemsToEnd(d),b._buffer.start+b._buffer.length>b._bottomBoundaryIndex&&(b._bottomBoundaryIndex=null),b._updateStateAsync())}}(this))},b.prototype._updateStateAsync=function(){return this._updatePlanned?void 0:(this._updatePlanned=!0,setTimeout(function(a){return function(){return a._updatePlanned=!1,a._updateState()}}(this),0))},b.prototype._updateState=function(){var a,b;return a=new Date,this._element.scrollTop===this._lastScrollTop&&a-this._lastScrollTopChange>this._settings.afterScrollWaitTime?this._element.scrollTop>this._settings.paddingTop.max?this._removeTopDrawnItem():this._element.scrollTop<this._settings.paddingTop.min&&this._tryDrawTopItem():(this._element.scrollTop!==this._lastScrollTop&&(this._lastScrollTop=this._element.scrollTop,this._lastScrollTopChange=a),this._updateStateAsync()),b=this._element.scrollHeight-this._element.scrollTop-this._element.offsetHeight,b<this._settings.paddingBottom.min?this._tryDrawBottomItem():b>this._settings.paddingBottom.max?this._removeBottomDrawnItem():void 0},b.prototype._addTopDrawnItem=function(a){return this._drawnItems=[a].concat(this._drawnItems),this.scope.$broadcast("top-item-rendered",a),this._updateStateAsync()},b.prototype._addBottomDrawnItem=function(a){return this._drawnItems.push(a),this.scope.$broadcast("bottom-item-rendered",a),this._updateStateAsync()},b.prototype._truncateBuffer=function(){var a,b;return b=this._drawnItems[0].index-this._settings.bufferTopPadding,a=this._drawnItems[this._drawnItems.length-1].index+this._settings.bufferBottomPadding,this._buffer.truncateTo(b,a)},b.prototype._removeTopDrawnItem=function(){return this._drawnItems=this._drawnItems.slice(1),this.scope.$broadcast("top-item-removed"),this._truncateBuffer(),this._updateStateAsync()},b.prototype._removeBottomDrawnItem=function(){return this._drawnItems.pop(),this.scope.$broadcast("bottom-item-removed"),this._truncateBuffer(),this._updateStateAsync()},b.prototype._tryDrawTopItem=function(){var a;return a=this._drawnItems.length>0?this._drawnItems[0].index-1:-1,a in this._buffer?this._addTopDrawnItem({index:a,data:this._buffer[a]}):this._canRequestMoreTopItems()?this._requestMoreTopItems():void 0},b.prototype._tryDrawBottomItem=function(){var a;return a=this._drawnItems.length>0?this._drawnItems[this._drawnItems.length-1].index+1:0,a in this._buffer?this._addBottomDrawnItem({index:a,data:this._buffer[a]}):this._canRequestMoreBottomItems()?this._requestMoreBottomItems():void 0},b.prototype.preserveScroll=function(a){var b,c;return c=this._element.scrollHeight,a(),b=this._element.scrollHeight-c,this._element.scrollTop+=b,this._lastScrollTop=this._element.scrollTop},b}(),b=function(){function a(a,b,c){this._$element=a,this._viewportController=b,this._$transclude=c,this._removeBottomItem=f(this._removeBottomItem,this),this._removeTopItem=f(this._removeTopItem,this),this._addBottomItem=f(this._addBottomItem,this),this._addTopItem=f(this._addTopItem,this),this._createItem=f(this._createItem,this),this._renderedItems=[],this._viewportController.scope.$on("top-item-rendered",this._addTopItem),this._viewportController.scope.$on("bottom-item-rendered",this._addBottomItem),this._viewportController.scope.$on("top-item-removed",this._removeTopItem),this._viewportController.scope.$on("bottom-item-removed",this._removeBottomItem)}return a.prototype._createItem=function(a,b){var c;return c={scope:null,clone:null,data:a},this._$transclude(function(a,d){return c.scope=d,c.clone=a[0],e(c.clone,b)}),c.scope.$apply(function(){return c.scope.scrData=c.data}),c},a.prototype._destroyItem=function(a){return a.clone.remove(),a.scope.$destroy()},a.prototype._addTopItem=function(a,b){return this._viewportController.preserveScroll(function(a){return function(){return a._renderedItems.unshift(a._createItem(b,a._$element[0]))}}(this))},a.prototype._addBottomItem=function(a,b){var c;return c=this._renderedItems.length>0?this._renderedItems[this._renderedItems.length-1].clone:this._$element[0],this._renderedItems.push(this._createItem(b,c))},a.prototype._removeTopItem=function(){return 0!==this._renderedItems.length?this._viewportController.preserveScroll(function(a){return function(){return a._destroyItem(a._renderedItems.shift())}}(this)):void 0},a.prototype._removeBottomItem=function(){var a,b;if(0!==this._renderedItems.length)return a=this._renderedItems.pop(),b=window.getSelection(),this._destroyItem(a)},a}(),angular.module("scroller",[]).directive("scrollerViewport",function(){return{restrict:"A",transclude:!0,scope:{scrollerSource:"=",scrollerSettings:"="},controller:function(a,b){return new c(a,b[0])}}}).directive("scrollerItem",function(){return{restrict:"A",priority:1e3,require:"^^scrollerViewport",transclude:"element",scope:{},link:function(a,c,d,e,f){return new b(c,e,f)}}})}).call(this);