(function(){var a,b,c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};d={paddingTop:{min:100,max:150},paddingBottom:{min:100,max:150},itemsPerRequest:10,autoUpdateInterval:1e3,afterScrollWaitTime:100,buffer:{topBoundaryTimeout:1e4,bottomBoundaryTimeout:1e4},bufferTopPadding:20,bufferBottomPadding:20},e=function(a,b){var c,d;return d=b.parentNode,b.nextSibling?(c=b.nextSibling,d.insertBefore(a,c)):d.appendChild(a)},c=function(){function b(b,c,e,g){this.scope=b,this._element=c,null==g&&(g={}),this.preserveScroll=f(this.preserveScroll,this),this._removeBottomDrawnItem=f(this._removeBottomDrawnItem,this),this._removeTopDrawnItem=f(this._removeTopDrawnItem,this),this._truncateBuffer=f(this._truncateBuffer,this),this._addBottomDrawnItem=f(this._addBottomDrawnItem,this),this._addTopDrawnItem=f(this._addTopDrawnItem,this),this._tryDrawBottomItem=f(this._tryDrawBottomItem,this),this._tryDrawTopItem=f(this._tryDrawTopItem,this),this._updateStateAsync=f(this._updateStateAsync,this),this._updateState=f(this._updateState,this),this._changeAutoUpdateInterval=f(this._changeAutoUpdateInterval,this),this.updateSettings=f(this.updateSettings,this),this._settings=angular.merge(g,d),this._drawnItems=[],this._buffer=new a(e,this._settings.buffer),this._updateStateAsync(),this._element.addEventListener("scroll",this._updateStateAsync),this._changeAutoUpdateInterval(this._settings.autoUpdateInterval)}return b.prototype.updateSettings=function(a){return null==a&&(a={}),angular.merge(a,d),this._settings.autoUpdateInterval!==a.autoUpdateInterval&&this._changeAutoUpdateInterval(a.autoUpdateInterval),this._settings=a,this._buffer.updateSettings(this._settings.buffer)},b.prototype._changeAutoUpdateInterval=function(a){return null!=this._autoUpdateHandler&&clearInterval(this._autoUpdateHandler),this._autoUpdateHandler=setInterval(this._updateStateAsync,a)},b.prototype._updateState=function(){var a,b;return a=new Date,this._element.scrollTop===this._lastScrollTop&&a-this._lastScrollTopChange>this._settings.afterScrollWaitTime?this._element.scrollTop>this._settings.paddingTop.max?this._removeTopDrawnItem():this._element.scrollTop<this._settings.paddingTop.min&&this._tryDrawTopItem():(this._element.scrollTop!==this._lastScrollTop&&(this._lastScrollTop=this._element.scrollTop,this._lastScrollTopChange=a),this._updateStateAsync()),b=this._element.scrollHeight-this._element.scrollTop-this._element.offsetHeight,b<this._settings.paddingBottom.min?this._tryDrawBottomItem():b>this._settings.paddingBottom.max?this._removeBottomDrawnItem():void 0},b.prototype._updateStateAsync=function(){return this._updatePlanned?void 0:(this._updatePlanned=!0,setTimeout(function(a){return function(){return a._updatePlanned=!1,a._updateState()}}(this),0))},b.prototype._tryDrawTopItem=function(){var a;return a=this._drawnItems.length>0?this._drawnItems[0].index-1:-1,a in this._buffer?this._addTopDrawnItem({index:a,data:this._buffer[a]}):this._buffer.requestMoreTopItems(this._settings.itemsPerRequest,this._updateStateAsync)},b.prototype._tryDrawBottomItem=function(){var a;return a=this._drawnItems.length>0?this._drawnItems[this._drawnItems.length-1].index+1:0,a in this._buffer?this._addBottomDrawnItem({index:a,data:this._buffer[a]}):this._buffer.requestMoreBottomItems(this._settings.itemsPerRequest,this._updateStateAsync)},b.prototype._addTopDrawnItem=function(a){return this._drawnItems=[a].concat(this._drawnItems),this.scope.$broadcast("top-item-rendered",a),this._updateStateAsync()},b.prototype._addBottomDrawnItem=function(a){return this._drawnItems.push(a),this.scope.$broadcast("bottom-item-rendered",a),this._updateStateAsync()},b.prototype._truncateBuffer=function(){var a,b;return b=this._drawnItems[0].index-this._settings.bufferTopPadding,a=this._drawnItems[this._drawnItems.length-1].index+this._settings.bufferBottomPadding,this._buffer.truncateTo(b,a)},b.prototype._removeTopDrawnItem=function(){return this._drawnItems=this._drawnItems.slice(1),this.scope.$broadcast("top-item-removed"),this._truncateBuffer(),this._updateStateAsync()},b.prototype._removeBottomDrawnItem=function(){return this._drawnItems.pop(),this.scope.$broadcast("bottom-item-removed"),this._truncateBuffer(),this._updateStateAsync()},b.prototype.preserveScroll=function(a){var b,c,d,e;return b=this._element.scrollHeight,d=this._element.scrollTop,a(),c=this._element.scrollHeight-b,e=this._element.scrollTop-d,this._element.scrollTop+=c-e,this._lastScrollTop=this._element.scrollTop},b}(),b=function(){function a(a,b,c){this._$element=a,this._viewportController=b,this._$transclude=c,this._removeBottomItem=f(this._removeBottomItem,this),this._removeTopItem=f(this._removeTopItem,this),this._addBottomItem=f(this._addBottomItem,this),this._addTopItem=f(this._addTopItem,this),this._createItem=f(this._createItem,this),this._renderedItems=[],this._viewportController.scope.$on("top-item-rendered",function(a){return function(b,c){return a._addTopItem(c)}}(this)),this._viewportController.scope.$on("bottom-item-rendered",function(a){return function(b,c){return a._addBottomItem(c)}}(this)),this._viewportController.scope.$on("top-item-removed",this._removeTopItem),this._viewportController.scope.$on("bottom-item-removed",this._removeBottomItem)}return a.prototype._createItem=function(a,b){var c;return c={scope:null,clone:null},this._$transclude(function(a,d){return c.scope=d,c.clone=a[0],e(c.clone,b)}),c.scope.$apply(function(){return c.scope.scrIndex=a.index,c.scope.scrData=a.data}),c},a.prototype._destroyItem=function(a){return a.clone.remove(),a.scope.$destroy()},a.prototype._addTopItem=function(a){return this._viewportController.preserveScroll(function(b){return function(){return b._renderedItems.unshift(b._createItem(a,b._$element[0]))}}(this))},a.prototype._addBottomItem=function(a){var b;return b=this._renderedItems.length>0?this._renderedItems[this._renderedItems.length-1].clone:this._$element[0],this._renderedItems.push(this._createItem(a,b))},a.prototype._removeTopItem=function(){return 0!==this._renderedItems.length?this._viewportController.preserveScroll(function(a){return function(){return a._destroyItem(a._renderedItems.shift())}}(this)):void 0},a.prototype._removeBottomItem=function(){var a;if(0!==this._renderedItems.length)return a=this._renderedItems.pop(),this._destroyItem(a)},a}(),a=function(){function a(a,b){this._getItems=a,this._settings=b,this.truncateTo=f(this.truncateTo,this),this._endOfDataReached=f(this._endOfDataReached,this),this.requestMoreBottomItems=f(this.requestMoreBottomItems,this),this._beginOfDataReached=f(this._beginOfDataReached,this),this.requestMoreTopItems=f(this.requestMoreTopItems,this),this.updateSettings=f(this.updateSettings,this),this._addItemsToStart=f(this._addItemsToStart,this),this._addItemsToEnd=f(this._addItemsToEnd,this),this.start=0,this.length=0,this._counter=0,this._top_items_request_id=null,this._bottom_items_request_id=null}return a.prototype._addItemsToEnd=function(a){var b,c,d,e;for(b=d=0,e=a.length;e>d;b=++d)c=a[b],this[this.start+this.length+b]=c;return this.length+=a.length},a.prototype._addItemsToStart=function(a){var b,c,d,e;for(this.start-=a.length,b=d=0,e=a.length;e>d;b=++d)c=a[b],this[this.start+b]=c;return this.length+=a.length},a.prototype.updateSettings=function(a){return this._settings=a},a.prototype.requestMoreTopItems=function(a,b){var c,d,e;if(null==this._top_items_request_id&&!this._beginOfDataReached())return d=this._top_items_request_id=this._counter,this._counter+=1,e=this.start-a,c=this.start,this._getItems(e,a,function(a){return function(e,f){return d!==a._top_items_request_id||(a._top_items_request_id=null,e)?void 0:0===f.length?(a._topBoundaryIndex=c,a._topBoundaryIndexTimestamp=new Date):(a._addItemsToStart(f),a.start<a._topBoundaryIndex&&(a._topBoundaryIndex=null),b())}}(this))},a.prototype._beginOfDataReached=function(){var a;return a=new Date,this.start===this._topBoundaryIndex&&a-this._topBoundaryIndexTimestamp<this._settings.topBoundaryTimeout},a.prototype.requestMoreBottomItems=function(a,b){var c,d;if(null==this._bottom_items_request_id&&!this._endOfDataReached())return c=this._bottom_items_request_id=this._counter,this._counter+=1,d=this.start+this.length,this._getItems(d,a,function(a){return function(e,f){return c!==a._bottom_items_request_id||(a._bottom_items_request_id=null,e)?void 0:0===f.length?(a._bottomBoundaryIndex=d,a._bottomBoundaryIndexTimestamp=new Date):(a._addItemsToEnd(f),a.start+a.length>a._bottomBoundaryIndex&&(a._bottomBoundaryIndex=null),b())}}(this))},a.prototype._endOfDataReached=function(){var a;return a=new Date,this.start+this.length===this._bottomBoundaryIndex&&a-this._bottomBoundaryIndexTimestamp<this._settings.bottomBoundaryTimeout},a.prototype.truncateTo=function(a,b){var c,d,e,f,g,h,i,j;if(this.start<a){for(d=e=g=this.start,h=a;h>=g?h>e:e>h;d=h>=g?++e:--e)delete this[d];this.length=Math.max(0,this.length-(a-this.start)),this.start=a,this._top_items_request_id=null}if(c=this.start+this.length-1,c>b){for(d=f=i=c,j=b;j>=i?j>f:f>j;d=j>=i?++f:--f)delete this[d];return this.length=Math.max(0,this.length-(c-b)),this._bottom_items_request_id=null}},a}(),angular.module("scroller",[]).directive("scrollerViewport",function(){return{restrict:"A",scope:{scrollerSource:"=",scrollerSettings:"="},controller:function(a,b){var d,e;return e=new c(a,b[0],a.scrollerSource,a.scrollerSettings),d=function(){return e.updateSettings(a.scrollerSettings)},a.$watch("scrollerSettings",d,!0),e}}}).directive("scrollerItem",function(){return{restrict:"A",priority:1e3,require:"^^scrollerViewport",transclude:"element",scope:{},link:function(a,c,d,e,f){return new b(c,e,f)}}})}).call(this);